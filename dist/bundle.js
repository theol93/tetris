!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t,i){var n=i(1),s=i(2);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);var r={insert:"head",singleton:!1},l=(n(e.i,s,r),s.locals?s.locals:{});e.exports=l},function(e,t,i){"use strict";var n,s=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},r=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),l={};function o(e,t,i){for(var n=0;n<t.length;n++){var s={css:t[n][1],media:t[n][2],sourceMap:t[n][3]};l[e][n]?l[e][n](s):l[e].push(y(s,i))}}function h(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var s=i.nc;s&&(n.nonce=s)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var l=r(e.insert||"head");if(!l)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");l.appendChild(t)}return t}var a,c=(a=[],function(e,t){return a[e]=t,a.filter(Boolean).join("\n")});function d(e,t,i,n){var s=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=c(t,s);else{var r=document.createTextNode(s),l=e.childNodes;l[t]&&e.removeChild(l[t]),l.length?e.insertBefore(r,l[t]):e.appendChild(r)}}function f(e,t,i){var n=i.css,s=i.media,r=i.sourceMap;if(s?e.setAttribute("media",s):e.removeAttribute("media"),r&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var u=null,p=0;function y(e,t){var i,n,s;if(t.singleton){var r=p++;i=u||(u=h(t)),n=d.bind(null,i,r,!1),s=d.bind(null,i,r,!0)}else i=h(t),n=f.bind(null,i,t),s=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else s()}}e.exports=function(e,t,i){return(i=i||{}).singleton||"boolean"==typeof i.singleton||(i.singleton=s()),e=i.base?e+i.base:e,t=t||[],l[e]||(l[e]=[]),o(e,t,i),function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){l[e]||(l[e]=[]),o(e,t,i);for(var n=t.length;n<l[e].length;n++)l[e][n]();l[e].length=t.length,0===l[e].length&&delete l[e]}}}},function(e,t,i){(t=i(3)(!1)).push([e.i,"body {\r\n    margin: 0;\r\n    background-color: black;\r\n}\r\n\r\n#root {\r\n    padding: 3rem;\r\n    text-align: center\r\n}\r\n\r\n#root h1 {\r\n    font-family: 'Press Start 2P', Consolas, monospace;\r\n    color: white;\r\n}\r\n\r\n#root canvas {\r\n    display: block;\r\n    margin: 0 auto;\r\n    \r\n    \r\n}\r\n\r\n",""]),e.exports=t},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var s=(l=n,o=btoa(unescape(encodeURIComponent(JSON.stringify(l)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(h," */")),r=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot).concat(e," */")}));return[i].concat(r).concat([s]).join("\n")}var l,o,h;return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n=0;n<e.length;n++){var s=[].concat(e[n]);i&&(s[2]?s[2]="".concat(i," and ").concat(s[2]):s[2]=i),t.push(s)}},t}},function(e,t,i){"use strict";i.r(t);i(0);const n=document.querySelector("#root"),s=new class{constructor(){this.score=0,this.lines=0,this.topOut=!1,this.playfield=this.createPlayfield(),this.activePiece=this.createPiece(),this.nextPiece=this.createPiece(),this.points={1:40,2:100,3:300,4:1200}}get level(){return Math.floor(.1*this.lines)}getState(){const e=this.createPlayfield(),{y:t,x:i,blocks:n}=this.activePiece;for(let t=0;t<this.playfield.length;t++){e[t]=[];for(let i=0;i<this.playfield[t].length;i++)e[t][i]=this.playfield[t][i]}for(let s=0;s<n.length;s++)for(let r=0;r<n[s].length;r++)n[s][r]&&(e[t+s][i+r]=n[s][r]);return{score:this.score,level:this.level,lines:this.lines,nextPiece:this.nextPiece,playfield:e,isGameOver:this.topOut}}reset(){this.score=0,this.lines=0,this.topOut=!1,this.playfield=this.createPlayfield(),this.activePiece=this.createPiece(),this.nextPiece=this.createPiece()}createPlayfield(){const e=[];for(let t=0;t<20;t++){e[t]=[];for(let i=0;i<10;i++)e[t][i]=0}return e}createPiece(){const e={x:0,y:0};switch("IJLOSTZ"[Math.floor(7*Math.random())]){case"I":e.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":e.blocks=[[0,0,0],[2,2,2],[0,0,2]];break;case"L":e.blocks=[[0,0,0],[3,3,3],[3,0,0]];break;case"O":e.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":e.blocks=[[0,0,0],[0,5,5],[5,5,0]];break;case"T":e.blocks=[[0,0,0],[6,6,6],[0,6,0]];break;case"Z":e.blocks=[[0,0,0],[7,7,0],[0,7,7]];break;default:throw new Error("I dont know what the error!")}return e.x=Math.floor((10-e.blocks[0].length)/2),e.y=-1,e}movePieceLeft(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}movePieceRight(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}movePieceDown(){if(!this.topOut){if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece();const e=this.clearLines();this.updateScore(e),this.updatePieces()}this.hasCollision()&&(this.topOut=!0)}}hasCollision(){const{y:e,x:t,blocks:i}=this.activePiece;for(let n=0;n<i.length;n++)for(let s=0;s<i[n].length;s++)if(i[n][s]&&(void 0===this.playfield[e+n]||void 0===this.playfield[e+n][t+s]||this.playfield[e+n][t+s]))return!0;return!1}rotatePiece(){this.rotateBlocks(),this.hasCollision()&&this.rotateBlocks(!1)}rotateBlocks(e=!0){const t=this.activePiece.blocks,i=t.length,n=Math.floor(i/2),s=i-1;for(let i=0;i<n;i++)for(let n=i;n<s-i;n++){const r=t[i][n];e?(t[i][n]=t[s-n][i],t[s-n][i]=t[s-i][s-n],t[s-i][s-n]=t[n][s-i],t[n][s-i]=r):(t[i][n]=t[n][s-i],t[n][s-i]=t[s-i][s-n],t[s-i][s-n]=t[s-n][i],t[s-n][i]=r)}}lockPiece(){const{y:e,x:t,blocks:i}=this.activePiece;for(let n=0;n<i.length;n++)for(let s=0;s<i[n].length;s++)i[n][s]&&(this.playfield[e+n][t+s]=i[n][s])}clearLines(){let e=[];for(let t=19;t>=0;t--){let i=0;for(let e=0;e<10;e++)this.playfield[t][e]&&(i+=1);if(0===i)break;i<10||10===i&&e.unshift(t)}for(let t of e)this.playfield.splice(t,1),this.playfield.unshift(new Array(10).fill(0));return e.length}updateScore(e){e>0&&(this.score+=this.points[e]*(this.level+1),this.lines+=e,console.log(this.score,this.lines))}updatePieces(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}},r=new class{constructor(e,t,i,n,s){this.colors={1:"cyan",2:"blue",3:"orange",4:"yellow",5:"green",6:"purple",7:"red"},this.element=e,this.width=t,this.height=i,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.playfieldBorderWidth=4,this.playfieldX=this.playfieldBorderWidth,this.playfieldY=this.playfieldBorderWidth,this.playfieldWidth=2*this.width/3,this.playfieldHeight=this.height,this.playfieldInnerWidth=this.playfieldWidth-2*this.playfieldBorderWidth,this.playfieldInnerHeight=this.playfieldHeight-2*this.playfieldBorderWidth,this.blockWidth=this.playfieldInnerWidth/s,this.blockHeight=this.playfieldInnerHeight/n,this.panelX=this.playfieldWidth+10,this.panelY=0,this.panelWidth=this.width/3,this.panelHeight=this.height,this.element.appendChild(this.canvas)}renderMainScreen(e){this.clearScreen(),this.renderPlayfield(e),this.renderPanel(e)}clearScreen(){this.context.clearRect(0,0,this.width,this.height)}renderStartScreen(){this.context.fillStyle="white",this.context.font='14px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("PRESS ENTER TO START GAME",this.width/2,this.height/2)}renderPauseScreen(){this.context.fillStyle="rgba(0,0,0,0.75)",this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle="white",this.context.font='14px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("PRESS ENTER TO RESUME",this.width/2,this.height/2)}renderEndScreen({score:e}){this.clearScreen(),this.context.fillStyle="white",this.context.font='14px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(":(",this.width/2,this.height/2-48),this.context.fillText(`YOU SCORE: ${e}!`,this.width/2,this.height/2),this.context.fillText("PRESS ENTER TO START NEW GAME",this.width/2,this.height/2+48)}renderPlayfield({playfield:e}){for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.length;e++){const n=i[e];n&&this.renderBlock(this.playfieldX+e*this.blockWidth,this.playfieldY+t*this.blockHeight,this.blockWidth,this.blockHeight,this.colors[n])}}this.context.strokeStyle="white",this.context.lineWidth=this.playfieldBorderWidth,this.context.strokeRect(0,0,this.playfieldWidth,this.playfieldHeight)}renderPanel({level:e,score:t,lines:i,nextPiece:n}){this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle="white",this.context.font='14px "Press Start 2P"',this.context.fillText(`Score: ${t}`,this.panelX,this.panelY+0),this.context.fillText(`Lines: ${i}`,this.panelX,this.panelY+24),this.context.fillText(`Level: ${e}`,this.panelX,this.panelY+48),this.context.fillText("Next:",this.panelX,this.panelY+96);for(let e=0;e<n.blocks.length;e++)for(let t=0;t<n.blocks[e].length;t++){const i=n.blocks[e][t];i&&this.renderBlock(this.panelX+t*this.blockWidth*.5,this.panelY+100+e*this.blockHeight*.5,.5*this.blockWidth,.5*this.blockHeight,this.colors[i])}}renderBlock(e,t,i,n,s){this.context.fillStyle=s,this.context.strokeStyle="black",this.context.lineWidth=2,this.context.fillRect(e,t,i,n),this.context.strokeRect(e,t,i,n)}}(n,480,640,20,10),l=new class{constructor(e,t){this.game=e,this.view=t,this.isPlay=!1,this.intervalId=null,document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),this.view.renderStartScreen()}update(){this.game.movePieceDown(),this.updateView()}pause(){this.isPlay=!1,this.stopTimer(),this.updateView()}reset(){this.game.reset(),this.play()}play(){this.isPlay=!0,this.startTimer(),this.updateView()}updateView(){const e=this.game.getState();e.isGameOver?this.view.renderEndScreen(e):this.isPlay?this.view.renderMainScreen(e):this.view.renderPauseScreen()}startTimer(){const e=1e3-100*this.game.getState().level;this.intervalId||(this.intervalId=setInterval(()=>{this.update()},e>0?e:100))}stopTimer(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}handleKeyDown(e){const t=this.game.getState();switch(e.keyCode){case 13:t.isGameOver?this.reset():this.isPlay?this.pause():this.play();break;case 37:this.game.movePieceLeft(),this.updateView();break;case 38:this.game.rotatePiece(),this.updateView();break;case 39:this.game.movePieceRight(),this.updateView();break;case 40:this.stopTimer(),this.game.movePieceDown(),this.updateView()}}handleKeyUp(e){switch(e.keyCode){case 40:this.startTimer()}}}(s,r);window.game=s,window.view=r,window.controller=l}]);